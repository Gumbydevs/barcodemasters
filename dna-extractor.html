// Firebase Monster Service
async function saveMonsterToFirebase(userId, monster, db) {
    try {
        // Add to user's monster collection
        await setDoc(doc(db, `users/${userId}/monsters`, monster.id), {
            ...monster,
            dateCreated: new Date().toISOString()
        });

        // Add to global monsters collection with user reference
        await setDoc(doc(db, 'monsters', monster.id), {
            ...monster,
            ownerId: userId,
            dateCreated: new Date().toISOString()
        });

        return true;
    } catch (error) {
        console.error('Error saving monster:', error);
        throw error;
    }
}

// Update your main script to include this after monster generation:
const handleMonsterGenerated = async (monster) => {
    const user = auth.currentUser;
    if (user) {
        try {
            await saveMonsterToFirebase(user.uid, monster, db);
            // Show success message
            updateDebugMessage('Monster successfully added to your collection!');
        } catch (error) {
            showError('Failed to save monster: ' + error.message);
        }
    } else {
        showError('Please log in to save your monster');
    }
};